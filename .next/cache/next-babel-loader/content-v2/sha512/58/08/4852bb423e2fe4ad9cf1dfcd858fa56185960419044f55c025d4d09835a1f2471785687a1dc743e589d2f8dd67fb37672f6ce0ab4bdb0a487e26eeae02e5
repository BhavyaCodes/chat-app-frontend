{"ast":null,"code":"// This endpoint doesn't really do anything. It just starts websockets.\n// NextJS does not officially support websockets. NextJS is intended for deployment\n// to serverless environments, which are mostly incompatible with websockets.\n// This application will have to be deployed to Heroku or a similar non-serverless\n// environment.\n// This solution is by rogeriojlle on StackOverflow:\n// https://stackoverflow.com/questions/57512366/how-to-use-socket-io-with-next-js-api-routes/62547135#62547135\nimport { Server } from \"socket.io\"; // import styles from '../styles/Home.module.css'\n\nconst ioHandler = (_req, res) => {\n  // if the socket server hasn't started yet, start it up.\n  if (!res.socket.server.io) {\n    console.log(\"First use, starting socket.io\"); // create the websocket server\n\n    const io = new Server(res.socket.server);\n    io.on(\"connection\", socket => {\n      // when a message is submitted, broadcast it.\n      socket.on(\"message-submitted\", msg => {\n        // echo the message back to the user\n        socket.emit(\"message\", msg); // broadcast the message to everyone else\n\n        socket.broadcast.emit(\"message\", msg);\n      });\n    }); // make the socket available externally.\n\n    res.socket.server.io = io;\n  } else {\n    // don't do anything if the server was already started.\n    console.log(\"Server already started\");\n  } // send back an empty 200\n\n\n  res.end();\n};\n\nexport default ioHandler;","map":{"version":3,"sources":["/Users/tanyaprabhakar/Chat/mychat/pages/api/chat.js"],"names":["Server","ioHandler","_req","res","socket","server","io","console","log","on","msg","emit","broadcast","end"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAQA,MAAR,QAAqB,WAArB,C,CACA;;AAEA,MAAMC,SAAS,GAAG,CAACC,IAAD,EAAOC,GAAP,KAAe;AAC/B;AACA,MAAI,CAACA,GAAG,CAACC,MAAJ,CAAWC,MAAX,CAAkBC,EAAvB,EAA2B;AACzBC,IAAAA,OAAO,CAACC,GAAR,CAAY,+BAAZ,EADyB,CAGzB;;AACA,UAAMF,EAAE,GAAG,IAAIN,MAAJ,CAAWG,GAAG,CAACC,MAAJ,CAAWC,MAAtB,CAAX;AAEAC,IAAAA,EAAE,CAACG,EAAH,CAAM,YAAN,EAAqBL,MAAD,IAAY;AAC9B;AACAA,MAAAA,MAAM,CAACK,EAAP,CAAU,mBAAV,EAAgCC,GAAD,IAAS;AACtC;AACAN,QAAAA,MAAM,CAACO,IAAP,CAAY,SAAZ,EAAuBD,GAAvB,EAFsC,CAGtC;;AACAN,QAAAA,MAAM,CAACQ,SAAP,CAAiBD,IAAjB,CAAsB,SAAtB,EAAiCD,GAAjC;AACA,OALF;AAMD,KARD,EANyB,CAgBzB;;AACAP,IAAAA,GAAG,CAACC,MAAJ,CAAWC,MAAX,CAAkBC,EAAlB,GAAuBA,EAAvB;AACD,GAlBD,MAkBO;AACL;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ;AACD,GAvB8B,CAyB/B;;;AACAL,EAAAA,GAAG,CAACU,GAAJ;AACD,CA3BD;;AA6BA,eAAeZ,SAAf","sourcesContent":["// This endpoint doesn't really do anything. It just starts websockets.\n// NextJS does not officially support websockets. NextJS is intended for deployment\n// to serverless environments, which are mostly incompatible with websockets.\n// This application will have to be deployed to Heroku or a similar non-serverless\n// environment.\n// This solution is by rogeriojlle on StackOverflow:\n// https://stackoverflow.com/questions/57512366/how-to-use-socket-io-with-next-js-api-routes/62547135#62547135\nimport {Server} from \"socket.io\"\n// import styles from '../styles/Home.module.css'\n\nconst ioHandler = (_req, res) => {\n  // if the socket server hasn't started yet, start it up.\n  if (!res.socket.server.io) {\n    console.log(\"First use, starting socket.io\");\n\n    // create the websocket server\n    const io = new Server(res.socket.server);\n\n    io.on(\"connection\", (socket) => {\n      // when a message is submitted, broadcast it.\n      socket.on(\"message-submitted\", (msg) => {\n        // echo the message back to the user\n        socket.emit(\"message\", msg);\n        // broadcast the message to everyone else\n        socket.broadcast.emit(\"message\", msg);\n       });\n    });\n\n    // make the socket available externally.\n    res.socket.server.io = io;\n  } else {\n    // don't do anything if the server was already started.\n    console.log(\"Server already started\");\n  }\n\n  // send back an empty 200\n  res.end();\n};\n\nexport default ioHandler;"]},"metadata":{},"sourceType":"module"}